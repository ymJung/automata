# 🚀 AI 주식 자동매매 시스템

한국투자증권 공식 API를 활용한 완전 자동화된 주식 매매 시스템입니다. 기술적 지표 기반의 스마트한 매매 전략과 리스크 관리 기능을 제공합니다.

## ✨ 주요 기능

### 📊 스마트 매매 전략
- **기술적 지표 분석**: 이동평균선, RSI, EWO, MACD, 볼린저 밴드
- **종목 스크리닝**: 88개 우량주 대상 실시간 분석
- **섹터 필터링**: IT, 금융, 바이오, 자동차, 배터리 등 선호 섹터 설정
- **DCA 전략**: 분할 매수를 통한 리스크 분산

### 🤖 완전 자동화
- **24시간 모의투자**: 장 시간 제약 없는 테스트 환경
- **실시간 모니터링**: 10초 주기 시장 분석
- **자동 주문 실행**: 매수/매도 신호 발생 시 즉시 주문
- **포트폴리오 관리**: 실시간 잔고 및 수익률 추적

### 📱 스마트 알림
- **텔레그램 연동**: 주문 체결, 수익률, 시스템 상태 실시간 알림
- **상세 로깅**: 모든 매매 활동 기록 및 분석

## 🎯 매매 전략

### 매수 조건
1. **과매수 EWO & 낮은 RSI**: 현재가 ≤ 단기 EMA, EWO ≥ 5, RSI ≤ 50
2. **과매도 EWO & 가격 하락**: 현재가 < (단기 EMA × 0.98), EWO ≤ -5

### 매도 조건
1. **이익 실현**: 현재가 ≥ (평균 매수가 × 1.05)
2. **손절매**: 현재가 ≤ (평균 매수가 × 0.65) - 35% 손실 시

### 종목 선정
- **우량주 중심**: KOSPI 200, 시가총액 상위 88개 종목
- **섹터 다변화**: IT, 금융, 바이오, 자동차, 배터리 등
- **동적 필터링**: 설정 파일을 통한 유연한 종목 관리

## 🛠 설치 및 설정

### 1. 환경 설정
```bash
# 가상환경 생성
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# venv\Scripts\activate   # Windows

# 필요 라이브러리 설치
pip install -r requirements.txt
```

### 2. API 설정
1. `config.cfg.sample`을 `config.cfg`로 복사
2. 한국투자증권 API 키 입력:
```ini
[kis]
APP_KEY = 발급받은_APP_KEY
APP_SECRET = 발급받은_APP_SECRET
ACCOUNT_NO = 계좌번호_8자리-2자리
MOCK_ACCOUNT_NO = 모의투자_계좌번호
```

### 3. 텔레그램 봇 설정 (선택사항)
```ini
[telegram]
TOKEN = 텔레그램_봇_토큰
CHAT_ID = 채팅_ID
```

### 4. 매매 전략 설정
```ini
[strategy]
# 기술적 지표 설정
short_ma_window = 5
long_ma_window = 20
rsi_window = 14
# ... 기타 설정

[stock_filter]
# 종목 필터링 설정
max_stocks_to_analyze = 50
preferred_sectors = IT,금융,바이오,자동차,배터리
exclude_sectors = 담배,항공
enable_sector_filter = true

[order]
# 주문 관리 설정
total_investment_per_stock = 100000
dca_divisions = 3
```

## 🚀 실행 방법

### 메인 시스템 실행
```bash
python run_trading_bot.py
```

### 테스트 실행
```bash
# 전체 시스템 테스트
python test_runner.py

# API 연결 테스트
python test_kis_connection.py

# 모의투자 24시간 테스트
python test_mock_trading.py

# 텔레그램 알림 테스트
python test_telegram.py
```

## 🔄 운영 모드

### 🧪 모의투자 모드 (권장)
- ✅ **24시간 실행 가능**
- ✅ 실제 돈 없이 전략 검증
- ✅ 모든 기능 테스트 가능
- ✅ 안전한 학습 환경

### 💰 실전투자 모드
- ⚠️ **장 시간에만 실행** (평일 09:00-15:30)
- ⚠️ 실제 자금 투입
- ⚠️ 충분한 테스트 후 사용 권장

## 📊 시스템 구조

```
📁 automata/
├── 🤖 main.py              # 메인 자동매매 로직
├── 🏦 kis_broker.py         # 한국투자증권 API 연동
├── 📈 indicators.py         # 기술적 지표 계산
├── 🎯 strategy.py           # 매매 전략 구현
├── 🔍 stock_selector.py     # 종목 선정 로직
├── 💼 portfolio.py          # 포트폴리오 관리
├── 📋 order_manager.py      # 주문 실행 관리
├── 📱 telegram_bot.py       # 텔레그램 알림
├── ⚙️ config.cfg           # 설정 파일
├── 🚀 run_trading_bot.py   # 실행 스크립트
└── 🧪 test_*.py            # 테스트 스크립트
```

## 📈 성과 모니터링

### 실시간 알림 (텔레그램)
- 📊 매수/매도 신호 발생
- 💰 주문 체결 결과
- 📈 일일/주간 수익률 리포트
- ⚠️ 시스템 오류 즉시 알림

### 로그 분석
- 📝 모든 매매 활동 기록
- 📊 전략 성과 분석
- 🔍 오류 추적 및 디버깅

## ⚠️ 주의사항

1. **투자 위험**: 주식 투자는 원금 손실 위험이 있습니다
2. **충분한 테스트**: 실전 투자 전 모의투자로 충분히 검증하세요
3. **설정 관리**: `config.cfg` 파일은 절대 공개하지 마세요
4. **시장 상황**: 급변하는 시장에서는 수동 개입이 필요할 수 있습니다
5. **법적 책임**: 모든 투자 결과에 대한 책임은 사용자에게 있습니다

## 🤝 기여하기

이 프로젝트는 오픈소스입니다. 버그 리포트, 기능 제안, 코드 기여를 환영합니다!

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

---

**⚡ 스마트한 투자의 시작, AI 자동매매 시스템과 함께하세요!**

## 매매 전략

이 문서는 주식 매매 프로그램의 핵심 전략을 정의합니다. 본 전략은 특정 지표들을 활용하여 매수 및 매도 시점을 결정하며, DCA(Dollar-Cost Averaging) 방식을 통해 리스크를 관리합니다.

### 1. 사용 지표

- **이동평균선 (EMA)**
  - **단기 EMA**: 5일 이동평균선
  - **장기 EMA**: 35일 이동평균선
- **RSI (Relative Strength Index)**: 14일 기준을 사용하여 시장의 과매수/과매도 상태를 판단합니다.
- **EWO (Elder's Wave Oscillator)**: 단기 EMA와 장기 EMA의 차이를 백분율로 계산합니다.
  - **기준치**: 과매수 신호는 `5`, 과매도 신호는 `−5`로 설정합니다.
    - `EWO ≥ 5`: 과매수 신호로 간주합니다.
    - `EWO ≤ −5`: 과매도 신호로 간주합니다.
- **데이터 누락 여부**: 1일 (5분봉 데이터 576개) 동안의 데이터 누락 여부를 확인하여 신뢰성 있는 분석을 위한 필수 조건으로 사용합니다.

### 2. 매수 조건

다음 두 가지 조건 중 하나라도 충족되면 매수 포지션을 고려합니다.

1.  **현재 가격이 단기 EMA 값 이하일 때**
    - `현재 가격 ≤ 단기 EMA 값`
    - **Low Offset 파라미터**: `-0.9`에서 `0.99` 사이의 값을 단기 EMA 값에 곱하여 기준치로 사용합니다.
    - EWO가 설정된 기준치 이상 (예: `5`, 과매수 신호)이어야 합니다.
    - RSI가 기준치 이하여야 합니다.
    - 데이터 누락이 없어야 합니다.

2.  **현재 가격이 (단기 EMA 값 * Low Offset)보다 낮을 때**
    - `현재 가격 < 단기 EMA 값 * Low Offset`
    - EWO가 설정된 기준치 이하 (예: `−5`, 과매도 신호)여야 합니다.
    - 데이터 누락이 없어야 합니다.

### 3. 주문 체결 방식

- **DCA (Dollar-Cost Averaging) 방식**: 분할 매수 전략을 채택하여 평균 매수 단가를 낮춥니다.
- **주문 분할**: 초기 주문 후 가격이 하락할 시 추가 매수를 진행합니다.
  - 기본적으로 3분할 주문 방식을 채택합니다.
  - 향후 5분할 전환도 고려 중입니다.

### 4. 매도 조건

다음 조건 중 하나라도 충족되면 매도 포지션을 고려합니다.

- **단기 EMA가 기준치 이상이고 거래량이 기준치 이상일 때**
  - `단기 EMA ≥ 기준치`
  - **High Offset**: 특정 종목에는 다른 값을 적용할 수 있습니다.
  - `거래량 ≥ 기준치`
- **손절매 (Stop Loss)**: 매수 가격 대비 `−35%` 하락 시 자동으로 손절매합니다.

---
*이 전략은 지속적인 검토와 시장 상황에 따른 최적화가 필요합니다.*
